<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin â€” Kelola Berita</title>
  <link rel="stylesheet" href="css/admin-berita.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

</head>
<body>
  <div class="admin-wrapper">
    <aside class="admin-sidebar">
      <h2>ğŸ“ Admin Panel</h2>
      <p class="subtitle">Kelola Berita</p>
      <ul class="admin-menu">
        <li><a href="admin.html">ğŸ“Š Dashboard</a></li>
        <li><a href="#" class="active">ğŸ“° Berita</a></li>
        <li><a href="admin-lomba.html">ğŸ† Lomba</a></li>
        <li><a href="admin-galeri.html">ğŸ¨ Galeri</a></li>
      </ul>
      <div class="admin-divider"></div>
      <button class="logout-btn" onclick="logout()">ğŸšª Logout</button>
    </aside>

    <main class="admin-content">
      <div class="admin-header">
        <button id="sidebarToggle" class="hamburger" aria-label="Toggle sidebar">â˜°</button>
        <h1>Kelola Berita</h1>
        <p>Tambahkan, edit atau hapus berita sekolah.</p>
      </div>

      <section class="admin-box" style="background:transparent;padding:0;box-shadow:none;">
          <div id="inlineForm" style="display:none;"> <!-- kept but hidden; modal will be used instead -->
          <div style="display:flex;gap:16px;flex-wrap:wrap;margin-bottom:18px;align-items:center;">
            <input id="judulBerita" placeholder="Judul Berita" style="flex:1;min-width:220px;padding:10px;border-radius:8px;border:1px solid var(--border);">
            <textarea id="isiBerita" placeholder="Isi Berita" style="flex:2;min-width:220px;padding:10px;border-radius:8px;border:1px solid var(--border);height:56px;"></textarea>
            <button id="saveBtn" class="card-action" onclick="tambahBerita()">Tambah</button>
            <button id="cancelEdit" class="card-action" style="display:none;background:#777;">Batal</button>
          </div>
        </div>

          <div class="table-toolbar" style="display:flex;gap:12px;align-items:left;margin-bottom:12px;">
            <input id="searchInput" placeholder="Cari berita..." aria-label="Cari berita" style="flex:1;padding:14px;border-radius:12px;border:1px solid var(--border);">
            <button id="addFloating" class="card-action">+ TAMBAH</button>
          </div>

          <div style="overflow:auto;border-radius:12px;background:var(--card);padding:14px;box-shadow:var(--shadow-sm);width:100%;">
          <table id="beritaTable" style="width:100%;border-collapse:collapse;">
            <thead>
              <tr style="text-align:left;color:var(--text-muted);font-weight:700;">
                <th style="padding:12px 8px;border-bottom:1px solid var(--border);width:48px;">No</th>
                <th style="padding:12px 8px;border-bottom:1px solid var(--border);">Judul</th>
                <th style="padding:12px 8px;border-bottom:1px solid var(--border);">Isi</th>
                  <th style="padding:12px 8px;border-bottom:1px solid var(--border);width:200px;">Aksi</th>
              </tr>
            </thead>
            <tbody>
              <!-- rows injected by script -->
            </tbody>
          </table>
        </div>
          <div id="tableFooter" style="text-align:center;color:var(--text-muted);padding:18px 0;">Menampilkan 0 dari 0 data</div>
      </section>
    </main>
  </div>

  <div id="sidebarOverlay" class="overlay hidden"></div>
  <!-- Modal for add / edit berita -->
  <div id="modalBerita" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <h3 id="modalTitle">Tambah Berita</h3>
      <div style="display:flex;flex-direction:column;gap:10px;margin-top:8px;">
        <input id="modalJudul" placeholder="Judul Berita" style="padding:10px;border-radius:8px;border:1px solid var(--border);">
        <textarea id="modalIsi" placeholder="Isi Berita" style="padding:10px;border-radius:8px;border:1px solid var(--border);min-height:120px;"></textarea>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px;">
          <button id="modalCancel" class="card-action" style="background:#777;">Batal</button>
          <button id="modalSave" class="card-action">Simpan</button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/app.js"></script>
  <script src="js/app.js"></script>
<script>
  let editingIndex = -1;

  const modal = document.getElementById('modalBerita');
  const modalTitle = document.getElementById('modalTitle');
  const modalJudul = document.getElementById('modalJudul');
  const modalIsi = document.getElementById('modalIsi');

  // â¬‡ï¸ TAMBAHAN INPUT FILE GAMBAR
  const fileInput = document.createElement("input");
  fileInput.type = "file";
  fileInput.accept = "image/*";
  fileInput.style.marginTop = "10px";
  modalIsi.after(fileInput);

  const previewImg = document.createElement("img");
  previewImg.style.maxWidth = "140px";
  previewImg.style.marginTop = "10px";
  previewImg.style.borderRadius = "10px";
  fileInput.after(previewImg);

  fileInput.onchange = () => {
    const file = fileInput.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => previewImg.src = e.target.result;
    reader.readAsDataURL(file);
  };

  function openAddModal(){
    editingIndex = -1;
    modalTitle.textContent = 'Tambah Berita';
    modalJudul.value = '';
    modalIsi.value = '';
    previewImg.src = '';
    fileInput.value = '';
    modal.classList.remove('hidden');
  }

  function openEditModal(i){
    editingIndex = i;
    const item = data.berita[i];
    modalTitle.textContent = 'Edit Berita';
    modalJudul.value = item.judul;
    modalIsi.value = item.isi;
    previewImg.src = item.gambar || '';
    fileInput.value = '';
    modal.classList.remove('hidden');
  }

  function closeModal(){
    modal.classList.add('hidden');
  }

  document.getElementById("modalCancel").onclick = closeModal;

  document.getElementById("modalSave").onclick = function(){
    const judul = modalJudul.value.trim();
    const isi = modalIsi.value.trim();

    if(!judul){ alert("Judul masih kosong"); return; }

    const gambar = previewImg.src || "";

    if(editingIndex >= 0){
      data.berita[editingIndex] = { judul, isi, gambar };
    } else {
      data.berita.push({ judul, isi, gambar });
    }

    localStorage.setItem("madingData", JSON.stringify(data));
    closeModal();
    renderBeritaTable();
  };

  function hapusBeritaLocal(i){
    if(!confirm("Hapus berita ini?")) return;
    data.berita.splice(i,1);
    localStorage.setItem("madingData", JSON.stringify(data));
    renderBeritaTable();
  }

  function renderBeritaTable(filterText=""){
    const tbody = document.querySelector('#beritaTable tbody');
    const footer = document.getElementById('tableFooter');

    const filtered = data.berita.filter(item =>
      (item.judul + item.isi).toLowerCase().includes(filterText.toLowerCase())
    );

    tbody.innerHTML = filtered.map((item,i)=>`
      <tr class="table-row">
        <td>${i+1}</td>
        <td>${item.judul}</td>
        <td>${item.isi}</td>
        <td>
          <div class="aksi-wrap">
            <button class="aksi-btn edit-btn" onclick="openEditModal(${i})">
              <i class="fas fa-pen"></i> Edit
            </button>

            <button class="aksi-btn hapus-btn" onclick="hapusBeritaLocal(${i})">
              <i class="fas fa-trash"></i> Hapus
            </button>
          </div>
        </td>
      </tr>
    `).join("");

    footer.textContent = `Menampilkan ${filtered.length} dari ${data.berita.length} data`;
  }

  document.getElementById("addFloating").onclick = openAddModal;

  document.getElementById("searchInput").addEventListener("input", e => {
    renderBeritaTable(e.target.value);
  });

  renderBeritaTable();
</script>
</body>
</html>
